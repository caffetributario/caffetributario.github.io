<!DOCTYPE html>
<html lang="it">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description"
        content="Tools professionali per Transfer Pricing e fiscalit√† internazionale - TP Guidelines OCSE, BEPS MLI Database, Calcolo Tassi ed Interessi.">
    <title>Tools | Il Caff√® Tributario</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800&display=swap"
        rel="stylesheet">
    <link rel="stylesheet" href="styles.css">
</head>

<body>
    <!-- Header -->
    <header class="header" id="header">
        <div class="container header-content">
            <a href="index.html" class="logo">
                <img src="logo.png" alt="Il Caff√® Tributario" class="logo-img">
            </a>
            <nav class="nav" id="nav">
                <a href="index.html" class="nav-link">Home</a>
                <div class="nav-item">
                    <a href="tools.html" class="nav-link active">
                        Tools
                        <svg class="dropdown-chevron" viewBox="0 0 24 24" fill="none" stroke="currentColor"
                            stroke-width="2">
                            <path d="M6 9l6 6 6-6" />
                        </svg>
                    </a>
                    <div class="nav-dropdown">
                        <a href="tools.html#tp-guidelines">
                            <svg class="nav-dropdown-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor"
                                stroke-width="2">
                                <path
                                    d="M12 6.253v13m0-13C10.832 5.477 9.246 5 7.5 5S4.168 5.477 3 6.253v13C4.168 18.477 5.754 18 7.5 18s3.332.477 4.5 1.253m0-13C13.168 5.477 14.754 5 16.5 5c1.747 0 3.332.477 4.5 1.253v13C19.832 18.477 18.247 18 16.5 18c-1.746 0-3.332.477-4.5 1.253" />
                            </svg>
                            TP Guidelines OCSE
                        </a>
                        <a href="tools.html#beps-mli">
                            <svg class="nav-dropdown-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor"
                                stroke-width="2">
                                <path
                                    d="M3.055 11H5a2 2 0 012 2v1a2 2 0 002 2 2 2 0 012 2v2.945M8 3.935V5.5A2.5 2.5 0 0010.5 8h.5a2 2 0 012 2 2 2 0 104 0 2 2 0 012-2h1.064M15 20.488V18a2 2 0 012-2h3.064M21 12a9 9 0 11-18 0 9 9 0 0118 0z" />
                            </svg>
                            BEPS MLI Database
                        </a>
                        <a href="tools.html#calcolo-tassi">
                            <svg class="nav-dropdown-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor"
                                stroke-width="2">
                                <path
                                    d="M9 7h6m0 10v-3m-3 3h.01M9 17h.01M9 14h.01M12 14h.01M15 11h.01M12 11h.01M9 11h.01M7 21h10a2 2 0 002-2V5a2 2 0 00-2-2H7a2 2 0 00-2 2v14a2 2 0 002 2z" />
                            </svg>
                            Calcolo Tassi ed Interessi
                        </a>
                    </div>
                </div>
                <a href="ricerche.html" class="nav-link">Ricerche</a>
                <a href="index.html#attualita" class="nav-link">Attualit√†</a>
                <a href="index.html#contatti" class="nav-link">Contatti</a>
            </nav>
            <button class="mobile-menu-btn" id="mobileMenuBtn" aria-label="Toggle menu">
                <span></span>
                <span></span>
                <span></span>
            </button>
        </div>
    </header>

    <!-- Page Header -->
    <section class="page-header">
        <div class="container">
            <span class="section-badge">Dashboard Professionale</span>
            <h1 class="section-title">Strumenti di Fiscalit√† Internazionale</h1>
            <p class="section-subtitle">
                Accesso unificato ai database interattivi OCSE e strumenti di calcolo nativi.
            </p>
        </div>
    </section>

    <!-- Tabs Section -->
    <section class="tabs-container">
        <div class="container">
            <div class="tabs-nav" role="tablist">
                <button class="tab-btn active" data-tab="tp-guidelines" role="tab" aria-selected="true">
                    üìö OCSE TP Library
                </button>
                <button class="tab-btn" data-tab="beps-mli" role="tab" aria-selected="false">
                    üåç MLI Matching Hub
                </button>
                <button class="tab-btn" data-tab="calcolo-tassi" role="tab" aria-selected="false">
                    üßÆ Verifica Soglie Usura
                </button>
            </div>

            <!-- Tab 1: TP Guidelines (ADVANCED MASKING) -->
            <div class="tab-content active" id="tp-guidelines" role="tabpanel">
                <div class="masked-iframe-wrapper">
                    <div class="iframe-loading" id="loading-tp">
                        <div class="spinner"></div>
                        <p>Innesco Sessione Protetta OCSE...</p>
                    </div>
                    <iframe id="iframe-tp-guidelines" src="https://tpguidelines.com/transfer-pricing-country-profiles/"
                        title="TP Country Profiles"
                        onload="document.getElementById('loading-tp').classList.add('hidden')" loading="lazy">
                    </iframe>
                </div>
            </div>

            <!-- Tab 2: BEPS MLI (DIRECT POWERBI EMBED) -->
            <div class="tab-content" id="beps-mli" role="tabpanel">
                <div class="powerbi-container">
                    <iframe
                        src="https://app.powerbi.com/view?r=eyJrIjoiYmQ5NGE3M2EtNTdhZi00NTFkLTkxNzEtNzQzMWU0NjBmYTI5IiwidCI6ImFjNDFjN2Q0LTFmNjEtNDYwZC1iMGY0LWZjOTI1YTJiNDcxYyIsImMiOjh9"
                        frameborder="0" allowFullScreen="true">
                    </iframe>
                </div>
            </div>

            <!-- Tab 3: Native Calcolo Tassi (NATIVE JS) -->
            <div class="tab-content" id="calcolo-tassi" role="tabpanel">
                <div class="native-tool-container">
                    <div class="calc-grid">
                        <div class="calc-form">
                            <h3 class="feature-title"
                                style="color: var(--color-white); margin-bottom: var(--spacing-4);">Setup Verifica Tassi
                            </h3>
                            <div class="form-group">
                                <label>Tipo di Finanziamento</label>
                                <select class="form-control" id="financing-type">
                                    <option value="10.36">Apertura di credito in C/C</option>
                                    <option value="9.45">Scoperto senza affidamento</option>
                                    <option value="5.80">Finanziamenti per anticipi su crediti</option>
                                    <option value="11.20">Credito personale</option>
                                    <option value="13.15">Cessione del quinto (fino a 15k)</option>
                                    <option value="10.80">Cessione del quinto (oltre 15k)</option>
                                    <option value="4.20">Leasing Immobiliare</option>
                                    <option value="3.95">Mutui Ipotecari (Fisso)</option>
                                    <option value="4.80">Mutui Ipotecari (Variabile)</option>
                                </select>
                            </div>
                            <div class="form-group">
                                <label>Tasso Applicato (%)</label>
                                <input type="number" step="0.01" class="form-control" id="applied-rate"
                                    placeholder="es. 12.50">
                            </div>
                            <div class="form-group">
                                <label>Trimestre di Riferimento</label>
                                <select class="form-control">
                                    <option>Ottobre - Dicembre 2024</option>
                                    <option>Luglio - Settembre 2024</option>
                                </select>
                            </div>
                        </div>
                        <div class="calc-results" id="calc-results">
                            <div class="result-card">
                                <div class="result-value" id="threshold-value">-- %</div>
                                <div class="result-label">Tasso Soglia Legale</div>
                            </div>
                            <div class="result-status" id="result-status">Inserisci i dati per la verifica</div>
                            <div
                                style="font-size: var(--font-size-xs); color: var(--color-gray-400); text-align: center;">
                                Fondato sui dati TEGM ufficiali (Banca d'Italia).
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </section>

    <!-- Footer -->
    <footer class="footer">
        <div class="container">
            <p>&copy; 2025 Il Caff√® Tributario. Tutti i diritti riservati.</p>
        </div>
    </footer>

    <script>
        // Tab switching
        const tabBtns = document.querySelectorAll('.tab-btn');
        const tabContents = document.querySelectorAll('.tab-content');

        tabBtns.forEach(btn => {
            btn.addEventListener('click', () => {
                const tabId = btn.dataset.tab;
                tabBtns.forEach(b => b.classList.remove('active'));
                btn.classList.add('active');
                tabContents.forEach(c => c.classList.remove('active'));
                document.getElementById(tabId).classList.add('active');
            });
        });

        // Native Calculator Logic
        const financingSelect = document.getElementById('financing-type');
        const appliedRateInput = document.getElementById('applied-rate');
        const thresholdDisplay = document.getElementById('threshold-value');
        const statusDisplay = document.getElementById('result-status');

        function calculateUsury() {
            const tegm = parseFloat(financingSelect.value);
            const applied = parseFloat(appliedRateInput.value);

            // Formula Legge 108/96: (TEGM * 1.25) + 4%
            // Lo spread non pu√≤ superare 8 punti
            let threshold = (tegm * 1.25) + 4;
            if ((threshold - tegm) > 8) {
                threshold = tegm + 8;
            }

            thresholdDisplay.innerText = threshold.toFixed(2) + ' %';

            if (!isNaN(applied)) {
                if (applied > threshold) {
                    statusDisplay.innerText = "ATTENZIONE: Tasso sopra la soglia legale";
                    statusDisplay.className = "result-status status-danger";
                } else {
                    statusDisplay.innerText = "Tasso conforme ai limiti di legge";
                    statusDisplay.className = "result-status status-safe";
                }
            }
        }

        financingSelect.addEventListener('change', calculateUsury);
        appliedRateInput.addEventListener('input', calculateUsury);

        // Mobile menu
        document.getElementById('mobileMenuBtn').addEventListener('click', function () {
            this.classList.toggle('active');
            document.getElementById('nav').classList.toggle('active');
        });

        // Hash navigation
        window.addEventListener('hashchange', () => {
            const hash = window.location.hash.replace('#', '');
            const target = document.querySelector(`[data-tab="${hash}"]`);
            if (target) target.click();
        });
        window.dispatchEvent(new Event('hashchange'));
    </script>
</body>

</html>